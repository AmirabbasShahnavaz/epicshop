{% extends 'base.html' %}

{% load static %}
{% load render_partial %}
{% load humanize %}

{% block title %}خرید و قیمت {{ product.title }}{% endblock %}

{% block content %}
    <div class="content">
        <div class="container-fluid">
            <div class="content-box">
                <div class="container-fluid">
                    <div class="row gy-3">
                        <div class="col-lg-4">
                            <div class="pro_gallery">
                                <div class="swiper product-gallery">
                                    <div class="swiper-wrapper" title="برای بزرگنمایی تصویر دابل کلیک کنید">
                                        <div class="swiper-slide">
                                            <div class="swiper-zoom-container">
                                                <img class="img-fluid" src="{{ product.image.url }}"/>
                                            </div>
                                        </div>
                                        {% for product_gallery in product.productgallery_set.all %}
                                            <div class="swiper-slide">
                                                <div class="swiper-zoom-container">
                                                    <img class="img-fluid" src="{{ product_gallery.image.url }}"/>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <div class="swiper-button-next d-none d-lg-flex"></div>
                                    <div class="swiper-button-prev d-none d-lg-flex"></div>
                                    <div class="swiper-pagination d-none d-lg-block"></div>
                                </div>
                                <div class="swiper product-gallery-thumb" thumbsSlider="">
                                    <div class="swiper-wrapper">
                                        <div class="swiper-slide">
                                            <img class="img-fluid" src="{{ product.image.url }}"/>
                                        </div>
                                        {% for product_gallery in product.productgallery_set.all %}
                                            <div class="swiper-slide">
                                                <img class="img-fluid" src="{{ product_gallery.image.url }}"/>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="box1">
                                    <div class="icon-product-box mt-3 btn-group w-100 box2">
                                        <div class="icon-product-box-item btn btn-lg bg-secondary-subtle py-4"
                                             data-bs-placement="top" data-bs-target="#shareModal"
                                             data-bs-toggle="modal" title="اشتراک گذاری">
                                            <i class="bi bi-share fs-4"></i>
                                        </div>
                                        {% if request.user.is_authenticated %}
                                            <div class="icon-product-box-item btn btn-lg bg-secondary-subtle py-4"
                                                 data-bs-placement="top"
                                                 data-bs-title="افزودن به علاقه مندی"
                                                 data-bs-toggle="tooltip" onclick="add_to_favorite({{ product.id }})">
                                                <i class="bi {% if is_favorite %}bi-heart-fill{% else %}bi-heart{% endif %} fs-4"></i>
                                            </div>
                                        {% else %}
                                            <a href="{% url 'login_page' %}?next={% url 'product_details_page' slug=product.slug %}">
                                                <div class="icon-product-box-item btn btn-lg bg-secondary-subtle py-4"
                                                     data-bs-placement="top"
                                                     data-bs-title="افزودن به علاقه مندی"
                                                     data-bs-toggle="tooltip">
                                                    <i class="bi bi-heart fs-4"></i>
                                                </div>
                                            </a>
                                        {% endif %}

                                        {#                                <div class="icon-product-box-item btn btn-lg bg-secondary-subtle py-4"#}
                                        {#                                     data-bs-placement="top" data-bs-title="مقایسه محصول"#}
                                        {#                                     data-bs-toggle="tooltip">#}
                                        {#                                    <i class="bi bi-arrow-left-right fs-4"></i>#}
                                        {#                                </div>#}
                                        {#                                <div class="icon-product-box-item btn btn-lg bg-secondary-subtle py-4"#}
                                        {#                                     data-bs-placement="top" data-bs-target="#chartModal"#}
                                        {#                                     data-bs-toggle="modal" data-bs-toggle="modal" title="نمودار تغییر قیمت">#}
                                        {#                                    <i class="bi bi-bar-chart fs-4"></i>#}
                                        {#                                </div>#}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <input type="hidden" id="csrf_token"
                                   value="{{ csrf_token }}">
                            <div class="product-meta-title mb-0">
                                <div class="row align-items-center gy-3">
                                    <div class="col-lg-10">
                                        <h4 class="mb-0"><a
                                                href="{% url 'product_list_category_page' category=product.category.url_title %}"
                                                class="main-color-one-color h6">{{ product.category.title }}</a>
                                        </h4>
                                        <h4 class="f-800 my-1">{{ product.title }}</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="product-meta-feature mt-1">
                                <div class="row gy-3">
                                    <div class="col-lg-7">
                                        <div class="product-meta-feature-items">
                                            <h5 class="title font-16">ویژگی های کالا</h5>
                                            <div class="se-desc">
                                                {% if product.features.count <= 8 %}
                                                    {% if product.features.count > 3 %}
                                                        <input type="checkbox" class="read-more-state" id="readMore1">
                                                        <ul class="read-more-wrap navbar-nav">
                                                            {% for item in product.features.all %}
                                                                <li {% if forloop.counter > 3 %}class="read-more-target "{% endif %}>
                                                                    <span class="title">{{ item.feature.name }}:</span>
                                                                    <span class="desc">{{ item.feature_value }}</span>
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                        <label for="readMore1" class="read-more-trigger"></label>
                                                    {% else %}
                                                        <ul class="read-more-wrap navbar-nav">
                                                            {% for item in product.features.all %}
                                                                <li>
                                                                    <span class="title">{{ item.feature.name }}:</span>
                                                                    <span class="desc">{{ item.feature_value }}</span>
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    {% endif %}
                                                {% else %}
                                                    {% for item in product.features.all %}
                                                        {% if forloop.counter <= 4 %}
                                                            <li>
                                                                <span class="title">{{ item.feature.name }}:</span>
                                                                <span class="desc">{{ item.feature_value }}</span>
                                                            </li>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="product-meta-color">
                                            <h5 class="font-16">
                                                انتخاب رنگ کالا
                                            </h5>
                                            <div class="product-meta-color-items">
                                                {% for product_color in product.productcolor_set.all %}
                                                    {% if product_color.quantity >= 1 %}
                                                        <input autocomplete="off"
                                                               {% if product.get_first_color.id == product_color.id %}checked{% endif %}
                                                               class="btn-check" id="color_{{ forloop.counter }}"
                                                               type="radio"
                                                               name="color"
                                                               onclick="change_color({{ product.id }}, {{ product_color.id }},{{ forloop.counter }})">
                                                        <label class="btn " for="color_{{ forloop.counter }}">
                                                            <span style="background-color: {{ product_color.color_code }};"></span>
                                                            {{ product_color.name }}
                                                        </label>
                                                    {% endif %}

                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-5">
                                        <div class="product-meta-info">
                                            <div class="product-meta-info-title border-0 product-meta-info-item d-flex align-items-center justify-content-between">
                                                <h5>فروشنده</h5>
                                            </div>
                                            <div class="d-flex product-meta-info-item">
                                                <div>
                                                    <i class="bi bi-shop"></i>
                                                </div>
                                                <div class="text-start ms-3">
                                                    <h6 class="fw-bold text-muted-2 font-16">{{ site_seller_name }}</h6>
                                                    <div class="d-flex align-items-center mt-2">
                                                        <p class="font-12 mb-0">
                                                            <span class="text-success ms-1 fw-bold">85%</span>
                                                            <span class="text-muted">رضایت از کالا</span>
                                                        </p>
                                                        <p class="ps-1 mb-0 ms-1 border-start font-12">
                                                            <span class="text-muted">عملکرد</span>
                                                            <span class="text-success fw-bold">عالی</span>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="product-meta-garanty product-meta-info-item justify-content-start">
                                                <i class="bi bi-shield-check"></i>
                                                <span class="text-muted"> گارانتی : {{ product.warranty_text }}
                                            </span>
                                            </div>
                                            <div class="product-meta-price product-price d-flex justify-content-between align-items-center">
                                                <h6 class="title-font new-price"
                                                    id="ppo">{{ product.get_first_color.price|intcomma:False }}
                                                    تومان</h6>
                                            </div>
                                            <div class="d-flex justify-content-between flex-wrap">
                                                <div class="product-meta-add mt-3 w-100">
                                                    <div class="d-flex justify-content-center">
                                                        <a class="btn btn-lg w-100 border-0 main-color-three-bg"
                                                           href="javascript:void(0)"
                                                           onclick="submit_form('basket_form')"><i
                                                                class="bi bi-basket text-white font-20 me-1"></i>خرید
                                                            کالا</a>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="product-feature">
                                <nav class="navbar navbar-expand">
                                    <ul class="navbar-nav flex-wrap justify-content-between w-100">
                                        <li class="nav-item">
                                            <a href="" class="nav-link">
                                                <img src="{% static 'assets/img/delivery.png' %}" alt="noImage">
                                                <p>تحویل اکسپرس</p>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="" class="nav-link">
                                                <img src="{% static 'assets/img/1-1.png' %}" alt="noImage">
                                                <p>پشتیبانی 24 ساعته</p>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="" class="nav-link">
                                                <img src="{% static 'assets/img/2-4.png' %}" alt="noImage">
                                                <p>پرداخت در محل</p>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="" class="nav-link">
                                                <img src="{% static 'assets/img/3-1.png' %}" alt="noImage">
                                                <p>7 روز ضمانت بازگشت کالا</p>
                                            </a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="product-desc py-20">
        <div class="container-fluid">
            <div class="row gy-3">
                <div class="col-lg-9">
                    <div class="product-desc-tab">
                        <ul class="nav justify-content-center" id="productTab" role="tablist">
                            <li class="nav-item">
                                <button aria-selected="true" class="active waves-effect waves-light"
                                        data-bs-target="#productDesc-pane" data-bs-toggle="tab" id="productDesc"
                                        role="button" type="button">
                                    توضیحات کالا
                                </button>
                            </li>
                            <li class="nav-item">
                                <button aria-selected="false" class=" waves-effect waves-light"
                                        data-bs-target="#productTable-pane" data-bs-toggle="tab" id="productTable"
                                        role="button" type="button">
                                    مشخصات کالا
                                </button>
                            </li>
                        </ul>
                    </div>
                    <div class="content-box">
                        <div class="container-fluid">
                            <div class="product-descs" id="prodesc">
                                <div class="product-desc">
                                    <div class="product-desc-tab-content">
                                        <div class="tab-content" id="productTabContent">
                                            <div class="tab-pane active show product-desc-contents"
                                                 id="productDesc-pane">
                                                <div class="product-desc-content">
                                                    {% if product.description|length > 802 %}
                                                        <input class="read-more-state" id="readMore2"
                                                               type="checkbox"/>
                                                        <div class="read-more-wrap">
                                                            <h6 class="font-26 mb-2 title-font title-line-bottom">
                                                                طراحی
                                                                و
                                                                کیفیت ساخت
                                                                {{ product.title }}
                                                            </h6>
                                                            <p></p>
                                                            {{ product.description|truncatechars:802|safe }}
                                                            <div class="read-more-target">
                                                                {{ product.description|safe }}
                                                            </div>
                                                        </div>
                                                        <label class="read-more-trigger" for="readMore2"></label>
                                                    {% else %}
                                                        <h6 class="font-26 mb-2 title-font title-line-bottom">
                                                            طراحی
                                                            و
                                                            کیفیت ساخت
                                                            {{ product.title }}
                                                        </h6>
                                                        {{ product.description|safe }}
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="productTable-pane">
                                                <div aria-labelledby="#productTable"
                                                     class="tab-pane fade active show" role="tabpanel">
                                                    <h6 class="font-26 mb-2 title-font title-line-bottom">مشخصات
                                                        فنی</h6>
                                                    <div class="box_list mt-4">
                                                        <p class="title">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="16"
                                                                 height="16" fill="currentColor"
                                                                 class="bi bi-caret-left-fill" viewBox="0 0 16 16">
                                                                <path
                                                                        d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z">
                                                                </path>
                                                            </svg>
                                                            مشخصات کلی
                                                        </p>
                                                        <div>
                                                            <ul class="param_list list-inline">
                                                                {% for item in product.features.all %}
                                                                    <li class="list-inline-item col-md-3 pe-md-1 pe-md-3 p-0 m-0">
                                                                        <div class="box_params_list">
                                                                            <p class="block border_right_custom1">
                                                                                {{ item.feature.name }}
                                                                            </p>
                                                                        </div>
                                                                    </li>
                                                                    <li class="list-inline-item col-md-8 p-0 m-0">
                                                                        <div class="box_params_list">
                                                                            <p class="block border_right_custom2">
                                                                                {{ item.feature_value }}
                                                                            </p>
                                                                        </div>
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 d-lg-block d-none">
                    <div class="product-meta-info bg-white position-sticky top-0">
                        <div class="product-meta-info-title border-0 product-meta-info-item d-flex align-items-center justify-content-between">
                            <h5>فروشنده</h5>
                        </div>
                        <div class="d-flex product-meta-info-item">
                            <div>
                                <i class="bi bi-shop"></i>
                            </div>
                            <div class="text-start ms-3">
                                <h6 class="fw-bold text-muted-2 font-16">{{ site_seller_name }}</h6>
                                <div class="d-flex align-items-center mt-2">
                                    <p class="font-12 mb-0">
                                        <span class="text-success ms-1 fw-bold">85%</span>
                                        <span class="text-muted">رضایت از کالا</span>
                                    </p>
                                    <p class="ps-1 mb-0 ms-1 border-start font-12">
                                        <span class="text-muted">عملکرد</span>
                                        <span class="text-success fw-bold">عالی</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="product-meta-garanty product-meta-info-item justify-content-start">
                            <i class="bi bi-shield-check"></i>
                            <span class="text-muted"> {{ product.warranty_text }}
                                            </span>
                        </div>
                        <div class="product-meta-price product-price d-flex justify-content-between align-items-center"
                        >
                            <h6 class="title-font new-price" id="ppt">{{ product.get_first_color.price|intcomma:False }}
                                تومان</h6>
                        </div>
                        <form action="{% url 'add_to_basket_page' %}" method="post" id="basket_form">
                            {% csrf_token %}
                            <input type="hidden" name="c_id" id="c_id" value="{{ product.get_first_color.id }}">
                            <input type="hidden" name="p_id" value="{{ product.id }}">
                        </form>
                        <div class="d-flex justify-content-between flex-wrap">
                            <div class="product-meta-counter w-100">
                                <div class="counter">
                                </div>
                            </div>
                            <div class="product-meta-add mt-3 w-100">
                                <div class="d-flex justify-content-center">
                                    <a class="btn btn-lg w-100 border-0 main-color-three-bg"
                                       href="javascript:void(0)" onclick="submit_form('basket_form')"><i
                                            class="bi bi-basket text-white font-20 me-1"></i>خرید
                                        کالا</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% include 'includes/product_slider_item.html' with dark_txt="محصولات" red_txt="مشابه" products=related_products %}
{% endblock %}